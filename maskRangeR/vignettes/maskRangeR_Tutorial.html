<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Cory Merow, Peter J. Galante, Cecina Babich Morrow, Jamie M. Kass, Alex Moore, Valentina Grisales-Betancur, Jorge Velasquez, Robert P. Anderson, Mary E. Blair" />

<meta name="date" content="2019-08-29" />

<title>maskRangeR: Improving spatial and temporal accuracy of species distribution models</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">maskRangeR: Improving spatial and temporal accuracy of species distribution models</h1>
<h4 class="author">Cory Merow, Peter J. Galante, Cecina Babich Morrow, Jamie M. Kass, Alex Moore, Valentina Grisales-Betancur, Jorge Velasquez, Robert P. Anderson, Mary E. Blair</h4>
<h4 class="date">2019-08-29</h4>


<div id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#data-driven-land-cover-mask"><span class="toc-section-number">2</span> Data Driven: Land Cover Mask</a><ul>
<li><a href="#issue"><span class="toc-section-number">2.1</span> Issue</a></li>
<li><a href="#needs"><span class="toc-section-number">2.2</span> Needs</a></li>
<li><a href="#background"><span class="toc-section-number">2.3</span> Background</a></li>
<li><a href="#methods"><span class="toc-section-number">2.4</span> Methods</a></li>
<li><a href="#references"><span class="toc-section-number">2.5</span> References</a></li>
<li><a href="#example"><span class="toc-section-number">2.6</span> Example</a></li>
</ul></li>
<li><a href="#expert-driven-masking-by-expert-maps"><span class="toc-section-number">3</span> Expert Driven: Masking by expert maps</a><ul>
<li><a href="#issue-1"><span class="toc-section-number">3.1</span> Issue</a></li>
<li><a href="#needs-1"><span class="toc-section-number">3.2</span> Needs</a></li>
<li><a href="#background-1"><span class="toc-section-number">3.3</span> Background</a><ul>
<li><a href="#biomodelos"><span class="toc-section-number">3.3.1</span> BioModelos</a></li>
<li><a href="#howler-monkey-example"><span class="toc-section-number">3.3.2</span> Howler Monkey Example</a></li>
</ul></li>
<li><a href="#methods-1"><span class="toc-section-number">3.4</span> Methods</a></li>
<li><a href="#example-1"><span class="toc-section-number">3.5</span> Example</a></li>
</ul></li>
<li><a href="#expert-driven-multiple-expert-masks"><span class="toc-section-number">4</span> Expert Driven: Multiple expert masks</a><ul>
<li><a href="#issue-2"><span class="toc-section-number">4.1</span> Issue</a></li>
<li><a href="#needs-2"><span class="toc-section-number">4.2</span> Needs</a></li>
<li><a href="#background-2"><span class="toc-section-number">4.3</span> Background</a></li>
<li><a href="#methods-2"><span class="toc-section-number">4.4</span> Methods</a></li>
<li><a href="#references-1"><span class="toc-section-number">4.5</span> References</a></li>
<li><a href="#example-2"><span class="toc-section-number">4.6</span> Example</a></li>
</ul></li>
<li><a href="#data-driven-masking-by-biotic-interactions"><span class="toc-section-number">5</span> Data Driven: Masking by biotic interactions</a><ul>
<li><a href="#issue-3"><span class="toc-section-number">5.1</span> Issue</a></li>
<li><a href="#needs-3"><span class="toc-section-number">5.2</span> Needs</a></li>
<li><a href="#background-3"><span class="toc-section-number">5.3</span> Background</a></li>
<li><a href="#methods-3"><span class="toc-section-number">5.4</span> Methods</a></li>
<li><a href="#references-2"><span class="toc-section-number">5.5</span> References</a></li>
<li><a href="#example-3"><span class="toc-section-number">5.6</span> Example</a><ul>
<li><a href="#spatial-svms"><span class="toc-section-number">5.6.1</span> Spatial SVMs</a></li>
<li><a href="#hybrid-svms"><span class="toc-section-number">5.6.2</span> Hybrid SVMs</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>The goal of masking range maps (or species distribution models) is to improve spatial (and possibly temporal) accuracy by incorporating different types of information. Often statistically-based SDMs are used to identify suitable environmental conditions, as the models detect locations with similar environmental conditions to where the species was observed. Often, these modeled maps are best interpreted as potential distributions since other processes besides abiotic conditions may restrict the distribution, such as dispersal, biotic interactions, social dynamics, historical contingencies, or human modification of habitat. In contrast, realized distributions describe those locations that are actually occupied by the species (at some spatial resolution) and may be smaller than potential distributions. By starting with potential distributions from any form of SDM, we can use other pieces of information to refine these models to approach realized distributions.</p>
<p>Here, we illustrate methods for estimating realized distributions based on different types of data. Additional information not included as a predictor in the SDM can be described by masks that differentiate potential habitat from non-habitat. They represent a conceptual model usually relating to a single variable, e.g., forest cover, occurrence of competing species, dispersal. When appropriate data are not available (e.g. climate data matching occurrence record collection dates), masks can be stacked on existing SDMs to determine places that both models designate as suitable habitat. Using a series of masks is a type of ensemble modeling where complete agreement is required between all component models to denote a location as suitable. Below, we illustrate cases based on forest cover, expert opinion, multiple environmental layers, and occurrence of competing species.</p>
<p>Throughout the package, we use the following definitions:</p>
<p><strong>Potential distribution</strong> is used to describe maps used as input. The term ‘potential’ is used because the map is presumed to include possibly suitable locations. These maps may well be the result of a model that includes processes such as dispersal, biotic interactions, social dynamics, historical contingencies, or human modification of habitat, but here we assume that there is further information that can be used to refine the range.</p>
<p><strong>Realized distribution</strong> is used to describe output maps resulting from masking of potential distributions. While the outputs may still include some ommission/commission errors, they aim to better estimate the realized distribution relative to the input maps by accounting for some additional source of information, e.g. land cover, expert opinion, biotic factors, etc.</p>
<!-- ================================================================== -->
<!-- ================================================================== -->
<!-- ================================================================== -->
<p>In the following use cases, we describe distribution modeling scenarios that require post-processing of the potential distribution to better estimate a species’ realized distribution. This post-processing is carried out in the form of masks based on expert opinion or data. For each scenario, we list the components needed to carry out the analysis and provide examples of the process.</p>
</div>
<div id="data-driven-land-cover-mask" class="section level1">
<h1><span class="header-section-number">2</span> Data Driven: Land Cover Mask</h1>
<div id="issue" class="section level2">
<h2><span class="header-section-number">2.1</span> Issue</h2>
<p>When creating SDMs, best practice dictates using environmental data that temporally match the occurrence records. However, this is not always realistic. Often, many occurrence records are from museum specimens that do not have relevant environmental data, e.g. forest cover. In such cases, recent occurrence records may be temporally matched to recent environmental data in order create a mask of values outside of observed ranges. This mask can be applied to the SDM to remove those geographic areas that are unsuitable for the species.</p>
</div>
<div id="needs" class="section level2">
<h2><span class="header-section-number">2.2</span> Needs</h2>
<p>These analyses require the following data:</p>
<ol style="list-style-type: decimal">
<li>SDM: a previously generated species distribution model.</li>
<li>Dated occurrence records: These can be dated yearly, monthly, or daily.</li>
<li>Recent environmental data: These can be dated yearly, monthly, or daily.</li>
</ol>
</div>
<div id="background" class="section level2">
<h2><span class="header-section-number">2.3</span> Background</h2>
<p>The Olinguito (<em>Bassaricyon neblina</em>) is a new species of carnivore described in 2013 from museum specimens that were previously identified as a different species [1]. The Olinguito lives in Northern Andean cloud forests in Colombia and Ecuador, and, according to experts, has strict tolerances for forest cover [2]. Recent occurrence records allow for very simple data-driven masking based on observed ranges of forest cover, but the number of occurrences (n = 18) is likely too few to use in model calibration. The data-driven determination of thresholds for masking using recent records represents a simple, conservative methodology that can be used for many species with limited recent records, and also will prove useful for processing of expert range maps or other pre-existing range estimates that do not take into account human modifications of the environment. <!-- We tested for any correlation between the forest layers and the climate layers used in the ENM to ensure they are contributing different information.  --></p>
</div>
<div id="methods" class="section level2">
<h2><span class="header-section-number">2.4</span> Methods</h2>
<p>A 30 arc-second Bioclimatic-variable climate-based Maxent [1] SDM was tuned for the Olinguito using a mix of historical data paired with field notes, as well as contemporary citizen science records associated with photo-vouchers. The model was trained on 0.7 degree buffered circles around occurrence records and then projected to a 5-degree bounding box around occurrence records. We then removed areas from the SDM representing biogeographic regions where the species has not been documented, like the Eastern Cordillera of Colombia and other small non-contiguous areas.</p>
<p>Next, we used remotely sensed data of the annual percent forest cover for the region (MODIS Vegetation Continuous Fields; 250 m from the years matching the most recent occurrence records: 2006-2016). The MODIS rasters from different years were not all aligned with one another and had to be realigned to create a raster stack. A subset of the more recent occurrence records (2006-2016) were then temporally matched with the forest cover rasters to obtain values of forest cover per occurrence (one record was excluded because it was based on an observation that stemmed from a likely roadkilled specimen [2]). The forest cover values at occurrence records were then assessed across all years, and the 25th quantile forest cover level was used to generate a forest cover mask for the most recent year (2010). After resampling the SDM to match the resolution of the MODIS data, we applied this forest cover mask to reduce the SDM’s spatial prediction to only those climatically suitable areas where forest cover is above the threshold. This reduced model shows a conservative estimation of the species range given current non-climatic variables that represent anthropogenic modification of land cover.</p>
</div>
<div id="references" class="section level2">
<h2><span class="header-section-number">2.5</span> References</h2>
<p>[1] Phillips, S.J., Anderson, R.P., Schapire, R.E. (2006) Maximum entropy modeling of species geographic distributions. <em>Ecological Modeling</em>, <strong>190</strong>, 231 - 259.</p>
<p>[2] Helgen, K.M., Miguel Pinto, C., Kays, R., Helgen, L.E., Tsuchiya, M. T. N., Quinn, A., Wilson, D.E., Maldonado, J.E. (2013) Taxonomic revision of the olingos (<em>Bassaricyon</em>), with description of a new species, the Olinguito. <em>Zookeys</em>, <strong>324</strong>, 1-83. <a href="https://doi.org/10.3897/zookeys.324.5827" class="uri">https://doi.org/10.3897/zookeys.324.5827</a>.</p>
<p>[3] Saavedra-Rodríguez, C. &amp; Rojas-Díaz, V. (2011) Bassaricyon gabbii Allen, 1876 (Carnivora: Procyonidae): new distribution point on western range of Colombian Andes. Check List 7(4), 505–507. <a href="http://dx.doi.org/10.15560/7.4.505" class="uri">http://dx.doi.org/10.15560/7.4.505</a>.</p>
</div>
<div id="example" class="section level2">
<h2><span class="header-section-number">2.6</span> Example</h2>
<p>By setting the pathway to where you saved our canned datasets by using the getDemoData() function, access that data by setting that as the working directory.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(maskRangeR)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">## Remember that the &#39;path&#39; is the directory in which you saved the demonstration data </span></a>
<a class="sourceLine" id="cb1-5" title="5">dataDir =<span class="st"> </span><span class="kw">paste0</span>(path, <span class="st">&#39;/dataDriven/olinguito/&#39;</span>) </a></code></pre></div>
<p>Read in the environmental and occurrence data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">dateScale &lt;-<span class="st"> &quot;year&quot;</span> <span class="co"># or &quot;month&quot;, &quot;day&quot;</span></a>
<a class="sourceLine" id="cb2-2" title="2">env &lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="kw">list.files</span>(<span class="dt">path =</span> <span class="kw">paste0</span>(dataDir), <span class="dt">pattern =</span> <span class="st">&quot;olinguito_Modis.tif$&quot;</span>, <span class="dt">full.names =</span> T))</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co"># this should be a formal date object of class &quot;POSIXct&quot; &quot;POSIXt&quot;</span></a>
<a class="sourceLine" id="cb2-4" title="4">envDates &lt;-<span class="st"> </span><span class="kw">parse_date_time</span>((<span class="kw">c</span>(<span class="st">&#39;2005&#39;</span>,<span class="st">&#39;2006&#39;</span>,<span class="st">&#39;2008&#39;</span>,<span class="st">&#39;2009&#39;</span>,<span class="st">&#39;2010&#39;</span>)),<span class="dt">orders =</span> <span class="kw">c</span>(<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Ym&quot;</span>))</a>
<a class="sourceLine" id="cb2-5" title="5">datedOccs &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;All_new_records_by_year.csv&#39;</span>))</a>
<a class="sourceLine" id="cb2-6" title="6">sdm &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;olinguito_SDM.tif&#39;</span>))</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co"># crop climate data to study region</span></a>
<a class="sourceLine" id="cb2-8" title="8">env &lt;-<span class="st"> </span><span class="kw">crop</span>(env, <span class="kw">extent</span>(sdm))</a></code></pre></div>
<p>Prepare the data.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># convert dates to formal date objects</span></a>
<a class="sourceLine" id="cb3-2" title="2">datedOccs<span class="op">$</span>date &lt;-<span class="st"> </span><span class="kw">parse_date_time</span>(datedOccs<span class="op">$</span>date,<span class="dt">orders =</span> <span class="kw">c</span>(<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;Ym&quot;</span>))</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co"># convert to spatial object</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">coordinates</span>(datedOccs) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;long&#39;</span>,<span class="st">&#39;lat&#39;</span>)</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">projection</span>(datedOccs) &lt;-<span class="st"> </span><span class="kw">projection</span>(env)</a></code></pre></div>
<p>To perform data-driven masking, first find the values of the environmental variable (forest cover in this example) at the occurrence point locations.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">datedOccs &lt;-<span class="st"> </span>maskRangeR<span class="op">::</span><span class="kw">annotate</span>(datedOccs,env,envDates,dateScale)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co"># Note the warnings:</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co"># [1] &quot;Environmental layers were missing for date 2013&quot;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co"># [1] &quot;Environmental layers were missing for date 2016&quot;</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co"># [1] &quot;Environmental layers were missing for date 2015&quot;</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co"># These indicate that you have occurrencee records that do not match some environmental data.</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co"># You may want to look into this to determine whether you expected to provide environmental layers associated with these dates. But if you didn&#39;t mean to provide such layers (e.g., here we did not provide layers fro 2013, 2015, and 2016) it is not an issue for using the package.</span></a></code></pre></div>
<p>Then find a suitable lower limit for the mask based on the data.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">(bounds &lt;-<span class="st"> </span><span class="kw">quantile</span>(datedOccs<span class="op">$</span>env,<span class="dt">prob=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">025</span>,.<span class="dv">25</span>,.<span class="dv">5</span>,.<span class="dv">75</span>,.<span class="dv">975</span>,<span class="dv">1</span>),<span class="dt">na.rm=</span>T))</a></code></pre></div>
<p>Note that here, there is an occurrence record showing 4% forest cover. This occurrence record comes from a roadkilled specimen, so it is likely not representative of necessary forest cover. To simplify for this vignette, we use the 25% observed forest cover as the lower limit.</p>
<p>Create the mask and mask the potential distribution using the most recent year’s forest cover.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">logicString &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;maskLayers&gt;&#39;</span>,<span class="kw">quantile</span>(datedOccs<span class="op">$</span>env,<span class="dt">prob=</span>.<span class="dv">25</span>,<span class="dt">na.rm=</span>T))</a>
<a class="sourceLine" id="cb6-2" title="2">forest &lt;-<span class="st"> </span>env[[<span class="dv">5</span>]]</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">names</span>(forest) &lt;-<span class="st"> &#39;forest&#39;</span></a>
<a class="sourceLine" id="cb6-4" title="4">maskedDist &lt;-<span class="st"> </span><span class="kw">maskRanger</span>(<span class="dt">initialDist=</span>sdm,<span class="dt">maskLayers=</span>forest,</a>
<a class="sourceLine" id="cb6-5" title="5">                                     <span class="dt">logicString=</span>logicString)</a></code></pre></div>
<p>If you additionally wanted to include an upper bound on the masking layer, this can be acheived with another call to <code>maskRanger</code>. Although we do not have expert knowledge of an upper limit on forest cover for this species, we pretend that there is an upper bound at the .999 percentile to illustrate how the code would work. In this call, the new <code>potentialDist</code> is the output of the previous call to <code>maskRanger</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">logicString &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;maskLayers&lt;&#39;</span>,<span class="kw">quantile</span>(datedOccs<span class="op">$</span>env,<span class="dt">prob=</span>.<span class="dv">999</span>,<span class="dt">na.rm=</span>T))</a>
<a class="sourceLine" id="cb7-2" title="2">forest &lt;-<span class="st"> </span>env[[<span class="dv">5</span>]]</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">names</span>(forest) &lt;-<span class="st"> &#39;forest&#39;</span></a>
<a class="sourceLine" id="cb7-4" title="4">output &lt;-<span class="st"> </span><span class="kw">maskRanger</span>(<span class="dt">initialDist=</span>maskedDist<span class="op">$</span>refinedDist,</a>
<a class="sourceLine" id="cb7-5" title="5">                                     <span class="dt">maskLayers=</span>forest,<span class="dt">logicString=</span>logicString)</a></code></pre></div>
<p>Note that all <code>maskRanger()</code> outputs follow the convention that the output is a stack with the refined distribution, the intial distribution, and any layers used to add or subtract regions to obtain the refined distribution.</p>
<p>To be sure the masking worked, check that there are now fewer cells in the masked map.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">(nOccupiedCells &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">values</span>(maskedDist[[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]]),<span class="dv">2</span>,sum,<span class="dt">na.rm=</span>T))</a></code></pre></div>
<p>Plot the results. The first map shows the percent forest cover across the study region in the most recent year. The second map shows regions where forest cover is above the 25th quantile threshold in green and the potential distribution from the SDM in grey. The third map compares the potential distribution (grey) to the masked distribution (red).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">plot</span>(forest,<span class="dt">main =</span> <span class="st">&#39;Raw Forest Data&#39;</span>)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">plot</span>(output[[<span class="st">&#39;forestMask&#39;</span>]],<span class="dt">main =</span> <span class="st">&#39;Forest Mask and Initial Distribution&#39;</span>)</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="kw">plot</span>(sdm,<span class="dt">add =</span> T,<span class="dt">col =</span> <span class="kw">c</span>(<span class="kw">grey</span>(<span class="dv">0</span>,<span class="dv">0</span>),<span class="kw">grey</span>(.<span class="dv">4</span>,.<span class="dv">7</span>)))</a>
<a class="sourceLine" id="cb9-5" title="5"><span class="kw">plot</span>(output<span class="op">$</span>refinedDist,<span class="dt">col =</span> <span class="kw">c</span>(<span class="kw">grey</span>(.<span class="dv">6</span>),<span class="st">&#39;red1&#39;</span>),<span class="dt">main =</span> <span class="st">&#39;Masked Distribution&#39;</span>)</a></code></pre></div>
<!-- ================================================================== -->
<!-- ================================================================== -->
<!-- ================================================================== -->
</div>
</div>
<div id="expert-driven-masking-by-expert-maps" class="section level1">
<h1><span class="header-section-number">3</span> Expert Driven: Masking by expert maps</h1>
<div id="issue-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Issue</h2>
<p>Range models may omit areas of presence, or include areas where the species does not exist. Expert knowledge can improve the realism of range models, either by adding suitable regions to a model or removing unsuitable ones.</p>
</div>
<div id="needs-1" class="section level2">
<h2><span class="header-section-number">3.2</span> Needs</h2>
<p>These analyses require the following data:</p>
<ol style="list-style-type: decimal">
<li>Expert defined area: This may be an area to add or remove to the species’ distribution.</li>
<li>SDM: This may be from an IUCN assessment, a thresholded SDM, or similar binary range indicator.</li>
</ol>
</div>
<div id="background-1" class="section level2">
<h2><span class="header-section-number">3.3</span> Background</h2>
<div id="biomodelos" class="section level3">
<h3><span class="header-section-number">3.3.1</span> BioModelos</h3>
<p><a href="http://biomodelos.humboldt.org.co/">BioModelos</a> is a web application for the collaborative development of species distribution models. In BioModelos, taxonomy/ecology/biogeography experts aid in</p>
<ol style="list-style-type: decimal">
<li>cleaning occurrence data</li>
<li>identifying species’ suitable land covers</li>
<li>selecting adequate omission thresholds to create binary models</li>
<li>identifying species’ accessible areas as well as areas of model over and underprediction</li>
<li>qualitatively evaluating the biological realism of resulting model predictions.</li>
</ol>
<p>A complete description of BioModelos is available <a href="https://www.biorxiv.org/content/early/2018/10/05/432617">here</a>.</p>
<p>Here, we provide an example of 4. indentifying species’ accessible areas as well as areas of model over and underprediction. Using the web tools available in BioModelos, an expert may draw a polygon on top of a geographic viewer to indicate A) a species’ accessible area, B) an area that must be removed from a model, or C) an area that must be added to a model.</p>
</div>
<div id="howler-monkey-example" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Howler Monkey Example</h3>
<p>The Howler Monkey, <em>Alouatta seniculus</em>, exemplifies a situation in which expert opinion was gathered using BioModelos to make range estimates more realistic. This species occurs in Colombia, Ecuador, Peru, Venezuela and Brazil (IUCN 2018). In Colombia, howler monkeys are widely distributed, occurring from 0-3200 meters. In the Choco biogeographic region, however, they are absent. This pattern is likely due to the dominance of closed canopies in the Choco rather than to any barrier to <em>A. seniculus</em> dispersal (Defler, 2010) since the mantled howler <em>Alouatta palliata</em> is better adapted to closed canopies than is <em>A. seniculus</em>.</p>
</div>
</div>
<div id="methods-1" class="section level2">
<h2><span class="header-section-number">3.4</span> Methods</h2>
<p>Records for <em>A. seniculus</em> in Colombia were curated independently by the Colombian Primatology Association and records from outside of Colombia were curated by the Primates Expert Group of BioModelos using the web app. A presence-only model for the distribution of this species was built using a background area spanning from north Peru to south Costa Rica and eastern Ecuador to Venezuela. This region was selected because it contains no known geographic barriers limiting the species’ dispersal.</p>
<p>The <code>ENMeval</code> package was used to select optimum feature classes/regularization values for the Maxent SDM. Records were partitioned using <code>checkerboard2</code>. The final model was run using all available occurrences and the regularization and feature class combination with the highest <span class="math inline">\(AUC_{test}\)</span> in model testing. Experts in the primates group selected the minimum training presence threshold as the threshold that best represented the prevalence of suitable climatic conditions for the species in the country. Once the model was thresholded, they also identified areas of model over- and underprediction. Therefore models were post-processed, as described <a href="https://github.com/LBAB-Humboldt/modeling/tree/master/primates">here</a>.</p>
<p>The following steps are possible ways to improve the realism of a potential distribution based on expert opinion:</p>
<ol style="list-style-type: decimal">
<li><strong>Add polygon</strong>: in some cases an expert may consider that a model underpredicts the suitable area for a species. For example, when modeling the distribution of <em>A. seniculus</em> in Colombia, there were gaps in the Amazon that were judged by experts as errors. Those missing areas can be added to the model by directly adding a polygon onto a GIS, indicating that model values in the area should be 1, or present.<br />
<!-- See link for illustration. --></li>
<li><strong>Remove polygon</strong> (not shown here): in some other cases, experts may consider that the model is predicting an area where the species’ presence is not possible. Again, for <em>A. seniculus</em>, experts considered that predictions of the distribution of this species in the Guajira peninsula were unlikely. They opted to remove that area from the model by drawing a polygon on the map indicating that in the area, model values should be 0, or absent.<br />
</li>
<li><strong>Mask model</strong>: (not shown) models may also need to be masked to 1) a drawn polygon; 2) a user provided shapefile; 3) a user-provided list of land covers. For <em>A. seniculus</em>, we clipped first by a user-drawn map and later by national boundaries (as we were not interested in predictions beyond Colombia; not shown). Later (not shown), we clipped that map using a list of land covers suitable for the species, as defined by experts, using a national land cover map.</li>
</ol>
</div>
<div id="example-1" class="section level2">
<h2><span class="header-section-number">3.5</span> Example</h2>
<p>By setting the pathway to where you saved our canned datasets by using the getDemoData() function, access that data by setting that as the working directory.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">library</span>(devtools)</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">library</span>(maskRangeR)</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb10-4" title="4"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb10-5" title="5"><span class="kw">library</span>(rgdal)</a>
<a class="sourceLine" id="cb10-6" title="6">dataDir =<span class="st"> </span><span class="kw">paste0</span>(path, <span class="st">&#39;/dataDriven/Alouatta/&#39;</span>)</a></code></pre></div>
<p>Read in the original SDM and the expert polygon.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">original =<span class="st"> </span><span class="kw">stack</span>(<span class="kw">paste0</span>(dataDir, <span class="st">&#39;Alouatta_seniculus_0_mx.tif&#39;</span>))</a>
<a class="sourceLine" id="cb11-2" title="2">expertAddedPoly =<span class="st"> </span>rgdal<span class="op">::</span><span class="kw">readOGR</span>(<span class="kw">paste0</span>(dataDir, <span class="st">&#39;Alouatta_seniculus_add_HO.shp&#39;</span>))</a></code></pre></div>
<p>Plot the original SDM.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">plot</span>(original, <span class="dt">main =</span> <span class="st">&quot;Range map&quot;</span>)</a></code></pre></div>
<p>Add the expert polygon to the SDM.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">expertAddRaster &lt;-<span class="st"> </span><span class="kw">rasterize</span>(expertAddedPoly,original, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb13-2" title="2">expertAddRaster[<span class="kw">is.na</span>(expertAddRaster)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb13-3" title="3">final =<span class="st"> </span>original<span class="op">+</span>expertAddRaster</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co"># remove overlap</span></a>
<a class="sourceLine" id="cb13-5" title="5">final[final<span class="op">&gt;</span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span></a></code></pre></div>
<p>Plot the new distribution model with the expert region added.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">plot</span>(final, <span class="dt">main =</span> <span class="st">&quot;Range map with </span><span class="ch">\n</span><span class="st"> expert area added&quot;</span>)</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">plot</span>(expertAddedPoly,<span class="dt">add =</span> T)</a></code></pre></div>
<p>Calculate the difference in range size.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">cellStats</span>(original,sum)</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="kw">cellStats</span>(final,sum)</a></code></pre></div>
<p>If you were combining this step with a masking step in the previous example, it might be helpful to organize the output the same as all <code>maskRanger()</code> outputs. This follows the convention that the output is a stack with the refined distribution, the intial distribution, and any layers used to add or subtract regions to obtain the refined distribution.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">output=<span class="kw">stack</span>(final,original,expertAddRaster)</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw">names</span>(output)=<span class="kw">c</span>(<span class="st">&quot;refinedDist&quot;</span>, <span class="st">&quot;initialDist&quot;</span>,<span class="st">&quot;expertAdded&quot;</span>)</a></code></pre></div>
<!-- ================================================================== -->
<!-- ================================================================== -->
<!-- ================================================================== -->
</div>
</div>
<div id="expert-driven-multiple-expert-masks" class="section level1">
<h1><span class="header-section-number">4</span> Expert Driven: Multiple expert masks</h1>
<div id="issue-2" class="section level2">
<h2><span class="header-section-number">4.1</span> Issue</h2>
<p>Some species may not have published occurrence records from which to define environmental tolerances. In these cases, multiple environmental layers are thresholded to the observed tolerances for the species. A range map is then masked by the tolerances, thereby reducing the area of the range map to only those areas suitable based on all environmental data.</p>
</div>
<div id="needs-2" class="section level2">
<h2><span class="header-section-number">4.2</span> Needs</h2>
<p>These analyses require the following data:</p>
<ol style="list-style-type: decimal">
<li>Environmental layers: These need to be layers deemed important to the species’ biology.</li>
<li>Environmental tolerances: These tolerances are used to threshold the environmental layers.</li>
<li>A range map: This map is generally a simplified overestimation of the range of the species and will therefore be reduced through a series of masks.</li>
</ol>
</div>
<div id="background-2" class="section level2">
<h2><span class="header-section-number">4.3</span> Background</h2>
<p>The “swamp forest crab” (<em>Parathelphusa reticulata</em>) is a freshwater crab endemic to the Nee Soon Swamp Forest, Singapore’s last remaining patch of freshwater swamp forest, and is currently listed as Critically Endangered by the IUCN. Like many freshwater crabs of the Southeast Asia, <em>P. reticulata</em> is primarily a scavenger that feeds on coarse organic matter, such as leaf litter. Given its endemic and endangered status, the ideal habitat parameters in which this species is found are highly restricted. However, available distribution information is quite limited: there is only one locality for this species available in GBIF, and the IUCN range map is a coarse overestimate. According to expert opinion, the environmental variables most closely associated with this species’ geographic range include distance to forest streams/swamps, pH, dissolved oxygen, temperature, elevation, and canopy cover. However, building a niche-based distribution model is not feasible due to considerable data and sample size limitations that likely violate the assumptions of the approach; the available high quality georeferenced occurrence data (N=1) do not capture the range of habitats occupied by the species.</p>
</div>
<div id="methods-2" class="section level2">
<h2><span class="header-section-number">4.4</span> Methods</h2>
<p>In this use case, we will perform an expert-driven species range estimate using a series of informed masks that constrain the coarse IUCN range map to a more realistic area of suitable environmental conditions. We will then constrain the range to: areas of soil pH from 5.17-5.79, dissolved oxygen from 27.2-36.6%, daytime air temperature 26-34˚C, elevation 16-26m, and canopy cover 75-100%. These tolerances were developed following Chua et al. (2015), a study that conducted fine-scale sampling in two of the nature reserves in Singapore known to have swamp forest crabs and analyzed the relationship between crab communities and environmental variables. Due to the species’ rarity, the occurrence data are not publicly available, however the environmental correlates described above are provided. Data layers include soil pH accessed from soilGrids.org [1], temperature data from worldclim.org [2], elevation from LPDAAC [3], canopy cover from Hansen et al., 2013 [4], and surface water from the global surface water database (Source: EC JRC/Google) [5]. Resolutions differ between layers, so rasters were either resampled or dis/aggregated to match the mask.</p>
</div>
<div id="references-1" class="section level2">
<h2><span class="header-section-number">4.5</span> References</h2>
<p>[1] Hengl T, Mendes de Jesus J, Heuvelink GBM, Ruiperez Gonzalez M, Kilibarda M, Blagotić A, et al. (2017) SoilGrids250m: Global gridded soil information based on machine learning. PLoS ONE 12(2): e0169748. <a href="https://doi.org/10.1371/journal.pone.0169748" class="uri">https://doi.org/10.1371/journal.pone.0169748</a><br />
[2] Hijmans, R. J., Cameron, S. E., Parra, J. L., Jones, P. G., &amp; Jarvis, A. (2005). Very high resolution interpolated climate surfaces for global land areas. International journal of climatology, 25(15), 1965-1978.<br />
[3] NASA/METI/AIST/Japan Space Systems. (2009). ASTER global digital elevation model [data set]. NASA EOSDIS Land Processes DAAC.<br />
[4] Hansen, M. C., Potapov, P. V., Moore, R., Hancher, M., Turubanova, S. A. A., Tyukavina, A., … &amp; Kommareddy, A. (2013). High-resolution global maps of 21st-century forest cover change. science, 342(6160), 850-853.<br />
[5] Jean-Francois Pekel, Andrew Cottam, Noel Gorelick, Alan S. Belward, High-resolution mapping of global surface water and its long-term changes. Nature 540, 418-422 (2016).</p>
<!-- Chua KWJ, Ng DJJ, Zeng Y, Yeo DCJ. 2015. Habitat characteristics of tropical rainforest freshwater crabs in Singapore. Journal of Crustacean Biology 35(4): 533-539. https://academic.oup.com/jcb/article/35/4/533/2547833  -->
<!-- [1] Hengl T, Mendes de Jesus J, Heuvelink GBM, Ruiperez Gonzalez M, Kilibarda M, Blagotić A, et al. (2017) SoilGrids250m: Global gridded soil information based on machine learning. PLoS ONE 12(2): e0169748. https://doi.org/10.1371/journal.pone.0169748 -->
<!-- [2] Hijmans, R. J., Cameron, S. E., Parra, J. L., Jones, P. G., & Jarvis, A. (2005). Very high resolution interpolated climate surfaces for global land areas. International journal of climatology, 25(15), 1965-1978. -->
<!-- [3] NASA/METI/AIST/Japan Space Systems. (2009). ASTER global digital elevation model [data set]. NASA EOSDIS Land Processes DAAC. -->
<!-- [4] Hansen, M. C., Potapov, P. V., Moore, R., Hancher, M., Turubanova, S. A. A., Tyukavina, A., ... & Kommareddy, A. (2013). High-resolution global maps of 21st-century forest cover change. science, 342(6160), 850-853. -->
<!-- [5] Jean-Francois Pekel, Andrew Cottam, Noel Gorelick, Alan S. Belward, High-resolution mapping of global surface water and its long-term changes. Nature 540, 418-422 (2016). (doi:10.1038/nature20584) -->
</div>
<div id="example-2" class="section level2">
<h2><span class="header-section-number">4.6</span> Example</h2>
<p>By setting the pathway to where you saved our canned datasets by using the getDemoData() function, access that data by setting that as the working directory.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">library</span>(maskRangeR)</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="kw">library</span>(rgdal)</a>
<a class="sourceLine" id="cb17-4" title="4">dataDir =<span class="st"> </span><span class="kw">paste0</span>(path, <span class="st">&#39;/expertDriven/swampForestCrab/&#39;</span>)</a></code></pre></div>
<!-- singapore=raster(paste0(dataDir,'/SingaporeRaster.tif')) -->
<p>Read in the expert map and the environmental layers.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">expertMap &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;IUCNshape/data_0.shp&#39;</span>))</a>
<a class="sourceLine" id="cb18-2" title="2"></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="co">#CM: pH and Water bounds are mutually exclusive, so we can only choose one, otherwise there is no suitable habitat. as I understand it, the soil grids shouldn&#39;t be taken too seriously at fine grain</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="co">#masks</span></a>
<a class="sourceLine" id="cb18-5" title="5">maskListRaw &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">treeCover =</span> <span class="kw">raster</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;/Hansen_percent_treecover.tif&#39;</span>)), </a>
<a class="sourceLine" id="cb18-6" title="6">                    <span class="dt">dem =</span> <span class="kw">raster</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;/DEM.tif&#39;</span>)),</a>
<a class="sourceLine" id="cb18-7" title="7">                    <span class="dt">mat =</span> <span class="kw">raster</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;/MATsingapore.tif&#39;</span>)),</a>
<a class="sourceLine" id="cb18-8" title="8">                    <span class="dt">pH =</span> <span class="kw">raster</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;/PHIHOX_M_sl1_250m.tif&#39;</span>)))</a>
<a class="sourceLine" id="cb18-9" title="9"></a>
<a class="sourceLine" id="cb18-10" title="10"><span class="co"># define the limits for each mask</span></a>
<a class="sourceLine" id="cb18-11" title="11">maskBounds &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;/crabInfo.csv&#39;</span>))</a></code></pre></div>
<p>Conduct data cleaning to fix names and units.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># rename the limits to match the raster names in maskListRaw</span></a>
<a class="sourceLine" id="cb19-2" title="2">maskBounds<span class="op">$</span>Layer &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;water&#39;</span>,<span class="st">&#39;treeCover&#39;</span>,<span class="st">&#39;dem&#39;</span>,<span class="st">&#39;pH&#39;</span>,<span class="st">&#39;mat&#39;</span>)</a>
<a class="sourceLine" id="cb19-3" title="3"><span class="co"># make sure the units match between the layers and the bounds</span></a>
<a class="sourceLine" id="cb19-4" title="4">maskListRaw<span class="op">$</span>mat &lt;-<span class="st"> </span>maskListRaw<span class="op">$</span>mat<span class="op">/</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb19-5" title="5">maskListRaw<span class="op">$</span>pH &lt;-<span class="st"> </span>maskListRaw<span class="op">$</span>pH<span class="op">/</span><span class="dv">10</span></a></code></pre></div>
<p>Crop rasters to the same extent as the expert map, since we do not need to build masks outside the expert map.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">crt &lt;-<span class="st"> </span>maskRangeR<span class="op">::</span><span class="kw">cropResampleTrim</span>(expertMap,maskListRaw)</a></code></pre></div>
<p>Create each mask, and mask the expert map.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">expertRaster &lt;-<span class="st"> </span>crt<span class="op">$</span>expertRaster</a>
<a class="sourceLine" id="cb21-2" title="2">maskStack &lt;-<span class="st"> </span>crt<span class="op">$</span>maskStack</a>
<a class="sourceLine" id="cb21-3" title="3">out &lt;-<span class="st"> </span><span class="kw">lotsOfMasks</span>(expertRaster,maskStack,maskBounds)</a></code></pre></div>
<p>Plot the realized distribution, along with each of masks.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw">plot</span>(out)</a></code></pre></div>
<p>We can zoom in to visualize what is left of the realized distribution after the masking process. The black polygon represents the original expert map and red locations indicate those that remain as suitable habitat after the masks have been applied.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">plot</span>(out<span class="op">$</span>initialDist,<span class="dt">col=</span><span class="st">&#39;grey&#39;</span>)</a>
<a class="sourceLine" id="cb23-2" title="2"><span class="kw">plot</span>(out<span class="op">$</span>refinedDist,<span class="dt">col =</span> <span class="st">&#39;red&#39;</span>,<span class="dt">add=</span>T)</a></code></pre></div>
<p>Calculate the difference in range size.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw">cellStats</span>(expertRaster,sum)</a>
<a class="sourceLine" id="cb24-2" title="2"><span class="kw">cellStats</span>(real,sum)</a></code></pre></div>
<!-- ================================================================== -->
<!-- ================================================================== -->
<!-- ================================================================== -->
</div>
</div>
<div id="data-driven-masking-by-biotic-interactions" class="section level1">
<h1><span class="header-section-number">5</span> Data Driven: Masking by biotic interactions</h1>
<div id="issue-3" class="section level2">
<h2><span class="header-section-number">5.1</span> Issue</h2>
<p>In addition to abiotic factors such as forest cover, temperature, elevation, etc., species’ distributions are also affected by biotic interactions [1]. For example, putative competitor species often have adjacent but non-overlapping, i.e. parapatric, ranges. In these situations, range estimates based on predictive models may overestimate ranges if the distribution of competitor species is not taken into account. To create more realistic models, we can post-process SDMs for each species to consider biotic constraints, e.g. the presence of a supposed competitor.</p>
</div>
<div id="needs-3" class="section level2">
<h2><span class="header-section-number">5.2</span> Needs</h2>
<p>These analyses require the following data:</p>
<ol style="list-style-type: decimal">
<li>Occurrence points: georeferenced records for each species.</li>
<li>SDMs for each species: If using a hybrid support vector machine (SVM), i.e. a classifier that accounts for the predicted suitability of habitat from the SDMs, SDM rasters of habitat suitability predictions for each species. The SDMs need to be projected to the same region and the resulting rasters need to have the same extent.</li>
</ol>
</div>
<div id="background-3" class="section level2">
<h2><span class="header-section-number">5.3</span> Background</h2>
<p>The three-toed sloths (<em>Bradypus</em> spp.) comprise four species distributed across Central and South America. With the exception of <em>B. pygmaeus</em>, which is restricted to Isla Escudos de Veraguas, the other three <em>Bradypus</em> species range across mainland Central and South America: <em>B. variegatus</em> is widely distributed from eastern Honduras to northern Argentina, <em>B. tridactylus</em> is found in the Guiana shield region, and <em>B. torquatus</em> occurs only in the Brazilian Atlantic Forest. <em>B. variegatus</em> and <em>B. tridactylus</em> exhibit parapatry, which is likely caused by competition for resources and/or suitable habitat [2]. This situation of congeneric species replacing each other across space is common. <em>B. variegatus</em> and <em>B. torquatus</em>, on the other hand, are sympatric in regions of the latter’s habitat in the Brazilian Atlantic Forest [3]. This analysis delimits the distributions of these three species by masking out regions predicted to be more suitable for the other two species.</p>
</div>
<div id="methods-3" class="section level2">
<h2><span class="header-section-number">5.4</span> Methods</h2>
<p>2.5 arc-minute Bioclimatic-variable climate-based Maxent SDMs were tuned for each species using occurrence data from literature thinned to a distance of 40 km. The SDMs were trained on a background region of 4-degree buffered circles around the thinned occurrence points and projected to a 2-degree bounding box around occurrence records.</p>
<p>After obtaining SDMs for each of the three species, we used the process below to create support vector machines (SVMs) to classify areas predicted to be more suitable for each of the three species. SVMs can be either spatial, using only the occurrence records of each species as predictors, or hybrid, using the habitat suitability from the SDMs as predictors in addition to the occurrence records. These SVMs are then used to mask the SDMs of each species to regions not predicted to be occupied by the other two species.</p>
</div>
<div id="references-2" class="section level2">
<h2><span class="header-section-number">5.5</span> References</h2>
<p>[1] Anderson, R.P. (2017) When and how should biotic interactions be considered in models of species niches and distributions? Journal of Biogeography, 44(1), 8-17.</p>
<p>[2] de Moraes-Barros, N., Giorgi (2010) Reevaluation of the Geographical Distribution of Bradypus tridactylus Linnaeus, 1758 and B. variegatus Schinz, 1825. Edentata, 11(1), 53-61.</p>
<p>[3] Hirsch, A., Chirello, A.G. (2012) The endangered maned sloth Bradypus torquatus of the Brazilian Atlantic forest: a review and update of geographical distribution and habitat preferences. Mammal Review, 42(1), 35-54.</p>
</div>
<div id="example-3" class="section level2">
<h2><span class="header-section-number">5.6</span> Example</h2>
<p>By setting the pathway to where you saved our canned datasets by using the getDemoData() function, access that data by setting that as the working directory.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">library</span>(maskRangeR)</a>
<a class="sourceLine" id="cb25-2" title="2"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb25-3" title="3"><span class="kw">library</span>(maptools)</a></code></pre></div>
<p>Read in the occurrence data and the SDMs for each species. Note that the SDMs must be projected to the same region for input into the hybrid SVMs. For the final step of masking, however, apply the mask to the SDM projected only to the region of biological interest for each species.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">dataDir =<span class="st"> </span><span class="kw">paste0</span>(path, <span class="st">&#39;/dataDriven/bradypus/&#39;</span>)</a>
<a class="sourceLine" id="cb26-2" title="2"></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="co"># Species occurrence coordinates</span></a>
<a class="sourceLine" id="cb26-4" title="4">variegatus &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;variegatus_occ.csv&#39;</span>))</a>
<a class="sourceLine" id="cb26-5" title="5">tridactylus &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;tridactylus_occ.csv&#39;</span>))</a>
<a class="sourceLine" id="cb26-6" title="6">torquatus &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;torquatus_occ.csv&#39;</span>))</a>
<a class="sourceLine" id="cb26-7" title="7"></a>
<a class="sourceLine" id="cb26-8" title="8"><span class="co"># SDMs projected to the same extent</span></a>
<a class="sourceLine" id="cb26-9" title="9">var_sdm &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;variegatus_sdm.tif&#39;</span>))</a>
<a class="sourceLine" id="cb26-10" title="10">tri_sdm &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;tridactylus_sdm.tif&#39;</span>))</a>
<a class="sourceLine" id="cb26-11" title="11">tor_sdm &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="kw">paste0</span>(dataDir,<span class="st">&#39;torquatus_sdm.tif&#39;</span>))</a>
<a class="sourceLine" id="cb26-12" title="12"></a>
<a class="sourceLine" id="cb26-13" title="13"><span class="co"># Crop tridactyus SDM to a 2-degree bounding box</span></a>
<a class="sourceLine" id="cb26-14" title="14">ext_tri &lt;-<span class="st"> </span><span class="kw">extent</span>(<span class="kw">c</span>(<span class="kw">min</span>(tridactylus<span class="op">$</span>longitude)<span class="op">-</span><span class="dv">2</span>, <span class="kw">max</span>(tridactylus<span class="op">$</span>longitude)<span class="op">+</span><span class="dv">2</span>, <span class="kw">min</span>(tridactylus<span class="op">$</span>latitude)<span class="op">-</span><span class="dv">2</span>, <span class="kw">max</span>(tridactylus<span class="op">$</span>latitude)<span class="op">+</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb26-15" title="15">tri_sdm_mask &lt;-<span class="st"> </span><span class="kw">mask</span>(tri_sdm, <span class="kw">as</span>(ext_tri, <span class="st">&quot;SpatialPolygons&quot;</span>))</a>
<a class="sourceLine" id="cb26-16" title="16"></a>
<a class="sourceLine" id="cb26-17" title="17"><span class="co"># Crop torquatus SDM to a 2-degree bounding box</span></a>
<a class="sourceLine" id="cb26-18" title="18">ext_tor &lt;-<span class="st"> </span><span class="kw">extent</span>(<span class="kw">c</span>(<span class="kw">min</span>(torquatus<span class="op">$</span>longitude)<span class="op">-</span><span class="dv">2</span>, <span class="kw">max</span>(torquatus<span class="op">$</span>longitude)<span class="op">+</span><span class="dv">2</span>, <span class="kw">min</span>(torquatus<span class="op">$</span>latitude)<span class="op">-</span><span class="dv">2</span>, <span class="kw">max</span>(torquatus<span class="op">$</span>latitude)<span class="op">+</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb26-19" title="19">tor_sdm_mask &lt;-<span class="st"> </span><span class="kw">mask</span>(tor_sdm, <span class="kw">as</span>(ext_tor, <span class="st">&quot;SpatialPolygons&quot;</span>))</a></code></pre></div>
<p>The following are the SDMs for each species, projected to the same extent and visualized on a map of South America:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co"># Get world map</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">data</span>(<span class="st">&quot;wrld_simpl&quot;</span>)</a>
<a class="sourceLine" id="cb27-3" title="3"><span class="co"># Create list of South American countries for visualization</span></a>
<a class="sourceLine" id="cb27-4" title="4">country_list &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Honduras&quot;</span>, <span class="st">&quot;Nicaragua&quot;</span>, <span class="st">&quot;Costa Rica&quot;</span>, <span class="st">&quot;Panama&quot;</span>, <span class="st">&quot;Colombia&quot;</span>,</a>
<a class="sourceLine" id="cb27-5" title="5">                  <span class="st">&quot;Ecuador&quot;</span>, <span class="st">&quot;Peru&quot;</span>, <span class="st">&quot;Bolivia&quot;</span>, <span class="st">&quot;Chile&quot;</span>, <span class="st">&quot;Argentina&quot;</span>, <span class="st">&quot;Uruguay&quot;</span>,</a>
<a class="sourceLine" id="cb27-6" title="6">                  <span class="st">&quot;Paraguay&quot;</span>, <span class="st">&quot;Brazil&quot;</span>, <span class="st">&quot;French Guiana&quot;</span>, <span class="st">&quot;Suriname&quot;</span>, <span class="st">&quot;Guyana&quot;</span>,</a>
<a class="sourceLine" id="cb27-7" title="7">                  <span class="st">&quot;Venezuela&quot;</span>)</a>
<a class="sourceLine" id="cb27-8" title="8"></a>
<a class="sourceLine" id="cb27-9" title="9"><span class="co"># Create 3-panel figure</span></a>
<a class="sourceLine" id="cb27-10" title="10"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb27-11" title="11"></a>
<a class="sourceLine" id="cb27-12" title="12"><span class="co"># Plot B. variegatus SDM</span></a>
<a class="sourceLine" id="cb27-13" title="13"><span class="kw">plot</span>(var_sdm, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">-30</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">27</span>, <span class="dv">16</span>))</a>
<a class="sourceLine" id="cb27-14" title="14"><span class="kw">plot</span>(wrld_simpl[wrld_simpl<span class="op">$</span>NAME <span class="op">%in%</span><span class="st"> </span>country_list,], <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb27-15" title="15"><span class="co"># Plot B. tridactylus SDM</span></a>
<a class="sourceLine" id="cb27-16" title="16"><span class="kw">plot</span>(tri_sdm_mask, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">70</span>, <span class="dv">-49</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">11</span>))</a>
<a class="sourceLine" id="cb27-17" title="17"><span class="kw">plot</span>(wrld_simpl[wrld_simpl<span class="op">$</span>NAME <span class="op">%in%</span><span class="st"> </span>country_list,], <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb27-18" title="18"><span class="co"># Plot B. torquatus SDM</span></a>
<a class="sourceLine" id="cb27-19" title="19"><span class="kw">plot</span>(tor_sdm_mask, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">46</span>, <span class="dv">-34</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">24</span>, <span class="dv">-8</span>))</a>
<a class="sourceLine" id="cb27-20" title="20"><span class="kw">plot</span>(wrld_simpl[wrld_simpl<span class="op">$</span>NAME <span class="op">%in%</span><span class="st"> </span>country_list,], <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<!-- # Reset plotting parameters -->
<!-- par(mfrow = c(1,1)) -->
<div id="spatial-svms" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Spatial SVMs</h3>
<p>Spatial SVMs are created using a classifier trained with the occurrence points of each species, without accounting for habitat suitability according to the SDM.</p>
<p>Tune the model and use it to predict ranges for each of the three species.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>) <span class="co"># to reproduce our exact results</span></a>
<a class="sourceLine" id="cb28-2" title="2"><span class="co"># Create SVM</span></a>
<a class="sourceLine" id="cb28-3" title="3">svmSP &lt;-<span class="st"> </span><span class="kw">rangeSVM</span>(variegatus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], tridactylus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], </a>
<a class="sourceLine" id="cb28-4" title="4">                  torquatus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">nrep =</span> <span class="dv">8</span>, <span class="dt">mc.cores=</span>mc.cores)</a>
<a class="sourceLine" id="cb28-5" title="5"></a>
<a class="sourceLine" id="cb28-6" title="6"><span class="co"># Use SVM to create a raster of predicted regions</span></a>
<a class="sourceLine" id="cb28-7" title="7">sloth_svmSP &lt;-<span class="st"> </span><span class="kw">rangeSVM_predict</span>(<span class="dt">svm =</span> svmSP, <span class="dt">r =</span> var_sdm)</a></code></pre></div>
<p>Plot the SVM results. The grey areas indicate regions more suitable for <em>B. variegatus</em>, the yellow areas indicate regions more suitable for <em>B. tridactylus</em>, and the green areas indicate regions more suitable for <em>B. torquatus</em>. Black points show the occurrences of <em>B. variegatus</em>, red show <em>B. tridactylus</em>, and blue show <em>B. torquatus</em>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">plot</span>(sloth_svmSP, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;pink&quot;</span>,<span class="st">&quot;lightblue&quot;</span>))</a>
<a class="sourceLine" id="cb29-2" title="2"><span class="kw">points</span>(variegatus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="fl">0.75</span>, <span class="dt">col =</span> <span class="st">&quot;orange&quot;</span>)</a>
<a class="sourceLine" id="cb29-3" title="3"><span class="kw">points</span>(tridactylus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="fl">0.75</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb29-4" title="4"><span class="kw">points</span>(torquatus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="fl">0.75</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p>We can use this SVM as a mask over our original SDM predictions.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="co"># masked SDM predictions for variegatus</span></a>
<a class="sourceLine" id="cb30-2" title="2">var_svmSP &lt;-<span class="st"> </span>sloth_svmSP <span class="op">==</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb30-3" title="3">var_svmSP[var_svmSP <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb30-4" title="4">var_svmSP_mask &lt;-<span class="st"> </span><span class="kw">mask</span>(var_sdm, var_svmSP)</a>
<a class="sourceLine" id="cb30-5" title="5">out.var=<span class="kw">stack</span>(var_svmSP_mask,var_sdm,var_svmSP)</a>
<a class="sourceLine" id="cb30-6" title="6"><span class="kw">names</span>(out.var)=<span class="kw">c</span>(<span class="st">&quot;refinedDist&quot;</span>, <span class="st">&quot;initialDist&quot;</span>,<span class="st">&quot;var_svmSpMask&quot;</span>)</a>
<a class="sourceLine" id="cb30-7" title="7"></a>
<a class="sourceLine" id="cb30-8" title="8"><span class="co"># masked SDM predictions for tridactylus</span></a>
<a class="sourceLine" id="cb30-9" title="9">tri_svmSP &lt;-<span class="st"> </span>sloth_svmSP <span class="op">==</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb30-10" title="10">tri_svmSP[tri_svmSP <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb30-11" title="11">tri_svmSP_mask &lt;-<span class="st"> </span><span class="kw">mask</span>(tri_sdm_mask, tri_svmSP)</a>
<a class="sourceLine" id="cb30-12" title="12">out.tri=<span class="kw">stack</span>(tri_svmSP_mask,tri_sdm,tri_svmSP)</a>
<a class="sourceLine" id="cb30-13" title="13"><span class="kw">names</span>(out.tri)=<span class="kw">c</span>(<span class="st">&quot;refinedDist&quot;</span>, <span class="st">&quot;initialDist&quot;</span>,<span class="st">&quot;tri_svmSpMask&quot;</span>)</a>
<a class="sourceLine" id="cb30-14" title="14"></a>
<a class="sourceLine" id="cb30-15" title="15"><span class="co"># masked SDM predictions for torquatus</span></a>
<a class="sourceLine" id="cb30-16" title="16">tor_svmSP &lt;-<span class="st"> </span>sloth_svmSP <span class="op">==</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb30-17" title="17">tor_svmSP[tor_svmSP <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb30-18" title="18">tor_svmSP_mask &lt;-<span class="st"> </span><span class="kw">mask</span>(tor_sdm_mask, tor_svmSP)</a>
<a class="sourceLine" id="cb30-19" title="19">out.tor=<span class="kw">stack</span>(tor_svmSP_mask,tor_sdm,tor_svmSP)</a>
<a class="sourceLine" id="cb30-20" title="20"><span class="kw">names</span>(out.tor)=<span class="kw">c</span>(<span class="st">&quot;refinedDist&quot;</span>, <span class="st">&quot;initialDist&quot;</span>,<span class="st">&quot;tor_svmSpMask&quot;</span>)</a></code></pre></div>
<p>Plot the predicted realized distributions for each species.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="co"># Create 3-panel figure</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb31-3" title="3"></a>
<a class="sourceLine" id="cb31-4" title="4"><span class="kw">plot</span>(var_svmSP_mask, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">-30</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">27</span>, <span class="dv">16</span>))</a>
<a class="sourceLine" id="cb31-5" title="5"><span class="kw">plot</span>(wrld_simpl[wrld_simpl<span class="op">$</span>NAME <span class="op">%in%</span><span class="st"> </span>country_list,], <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb31-6" title="6"><span class="kw">plot</span>(tri_svmSP_mask, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">70</span>, <span class="dv">-49</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">11</span>))</a>
<a class="sourceLine" id="cb31-7" title="7"><span class="kw">plot</span>(wrld_simpl[wrld_simpl<span class="op">$</span>NAME <span class="op">%in%</span><span class="st"> </span>country_list,], <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb31-8" title="8"><span class="kw">plot</span>(tor_svmSP_mask, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">46</span>, <span class="dv">-34</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">24</span>, <span class="dv">-8</span>))</a>
<a class="sourceLine" id="cb31-9" title="9"><span class="kw">plot</span>(wrld_simpl[wrld_simpl<span class="op">$</span>NAME <span class="op">%in%</span><span class="st"> </span>country_list,], <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="hybrid-svms" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Hybrid SVMs</h3>
<p>Hybrid SVMs take into account the occurrence points of all species as well as the environmental suitability predicted by the species’ SDMs.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb32-2" title="2"><span class="co"># Create SVM: we used a few more reps here to be sure a set of optimal parameters was found</span></a>
<a class="sourceLine" id="cb32-3" title="3">svmHYB &lt;-<span class="st"> </span><span class="kw">rangeSVM</span>(variegatus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], tridactylus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], torquatus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], </a>
<a class="sourceLine" id="cb32-4" title="4">                   <span class="dt">sdm =</span> raster<span class="op">::</span><span class="kw">stack</span>(var_sdm, tri_sdm, tor_sdm), </a>
<a class="sourceLine" id="cb32-5" title="5">                   <span class="dt">nrep =</span> <span class="dv">14</span>, <span class="dt">mc.cores=</span>mc.cores)</a>
<a class="sourceLine" id="cb32-6" title="6"></a>
<a class="sourceLine" id="cb32-7" title="7"><span class="co"># Use SVM to create a raster of predicted regions</span></a>
<a class="sourceLine" id="cb32-8" title="8">sloth_svmHYB &lt;-<span class="st"> </span><span class="kw">rangeSVM_predict</span>(<span class="dt">svm =</span> svmHYB, <span class="dt">r =</span> var_sdm, </a>
<a class="sourceLine" id="cb32-9" title="9">                                 <span class="dt">sdm =</span> raster<span class="op">::</span><span class="kw">stack</span>(var_sdm, tri_sdm, tor_sdm))</a></code></pre></div>
<p>Plot the SVM results.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw">plot</span>(sloth_svmHYB, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;pink&quot;</span>,<span class="st">&quot;lightblue&quot;</span>))</a>
<a class="sourceLine" id="cb33-2" title="2"><span class="kw">points</span>(variegatus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="fl">0.75</span>, <span class="dt">col =</span> <span class="st">&quot;orange&quot;</span>)</a>
<a class="sourceLine" id="cb33-3" title="3"><span class="kw">points</span>(tridactylus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="fl">0.75</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb33-4" title="4"><span class="kw">points</span>(torquatus[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="fl">0.75</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p>Use the hybrid SVM as a mask over our SDM predictions.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="co"># masked SDM predictions for variegatus</span></a>
<a class="sourceLine" id="cb34-2" title="2">var_svmHYB &lt;-<span class="st"> </span>sloth_svmHYB <span class="op">==</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb34-3" title="3">var_svmHYB[var_svmHYB <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb34-4" title="4">var_svmHYB_mask &lt;-<span class="st"> </span><span class="kw">mask</span>(var_sdm, var_svmHYB)</a>
<a class="sourceLine" id="cb34-5" title="5"></a>
<a class="sourceLine" id="cb34-6" title="6"><span class="co"># masked SDM predictions for tridactylus</span></a>
<a class="sourceLine" id="cb34-7" title="7">tri_svmHYB &lt;-<span class="st"> </span>sloth_svmHYB <span class="op">==</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb34-8" title="8">tri_svmHYB[tri_svmHYB <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb34-9" title="9">tri_svmHYB_mask &lt;-<span class="st"> </span><span class="kw">mask</span>(tri_sdm_mask, tri_svmHYB)</a>
<a class="sourceLine" id="cb34-10" title="10"></a>
<a class="sourceLine" id="cb34-11" title="11"><span class="co"># masked SDM predictions for torquatus</span></a>
<a class="sourceLine" id="cb34-12" title="12">tor_svmHYB &lt;-<span class="st"> </span>sloth_svmHYB <span class="op">==</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb34-13" title="13">tor_svmHYB[tor_svmHYB <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb34-14" title="14">tor_svmHYB_mask &lt;-<span class="st"> </span><span class="kw">mask</span>(tor_sdm_mask, tor_svmHYB)</a></code></pre></div>
<p>Plot the predicted realized distributions for each species.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="co"># Create 3-panel figure</span></a>
<a class="sourceLine" id="cb35-2" title="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb35-3" title="3"></a>
<a class="sourceLine" id="cb35-4" title="4"><span class="kw">plot</span>(var_svmHYB_mask, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">90</span>, <span class="dv">-30</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">27</span>, <span class="dv">16</span>))</a>
<a class="sourceLine" id="cb35-5" title="5"><span class="kw">plot</span>(wrld_simpl[wrld_simpl<span class="op">$</span>NAME <span class="op">%in%</span><span class="st"> </span>country_list,], <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb35-6" title="6"><span class="kw">plot</span>(tri_svmHYB_mask, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">70</span>, <span class="dv">-49</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">11</span>))</a>
<a class="sourceLine" id="cb35-7" title="7"><span class="kw">plot</span>(wrld_simpl[wrld_simpl<span class="op">$</span>NAME <span class="op">%in%</span><span class="st"> </span>country_list,], <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb35-8" title="8"><span class="kw">plot</span>(tor_svmHYB_mask, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">46</span>, <span class="dv">-34</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">24</span>, <span class="dv">-8</span>))</a>
<a class="sourceLine" id="cb35-9" title="9"><span class="kw">plot</span>(wrld_simpl[wrld_simpl<span class="op">$</span>NAME <span class="op">%in%</span><span class="st"> </span>country_list,], <span class="dt">add =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>After creating masks such as these based on biotic factors, one could further mask by forest cover, accessible habitat, or other factors.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
